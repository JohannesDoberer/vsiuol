sap.ui.define(["sap/ui/model/json/JSONModel", "@luigi-project/client/luigi-client"], function (JSONModel, LuigiClient) {

    LuigiClient.addInitListener((ctx) => {
        console.log('ctx init', ctx);
        this.model.setData(ctx);
    });

    LuigiClient.addContextUpdateListener((ctx) => {
        console.log('ctx update', ctx);
        this.model.setData(ctx);
    });

    return {

        connectTo: function (oComponent) {
            const routingConfig = oComponent.getManifestEntry('sap.ui5').routing;
            oComponent.getRouter().attachRouteMatched((oEvent) => {
                oComponent.setModel(new JSONModel(LuigiClient.getContext()), "$luigi");
                const currentRoute = oEvent.getParameter('name');
                const args = oEvent.getParameter('arguments');
                let currentRouteObj = {};
                routingConfig.routes.every(routeObj => {
                    if (routeObj.name === currentRoute) {
                        currentRouteObj = routeObj;
                        currentRouteObj.arguments = args;
                        return false;
                    }
                    return true;
                });

                if (currentRouteObj) {
                    let lm = LuigiClient.linkManager().withoutSync();
                    const ux = LuigiClient.uxManager();
                    let route = currentRoute;
                    if (currentRouteObj.data) {
                        if (currentRouteObj.data.luigiRoute) {
                            route = currentRouteObj.data.luigiRoute;

                            if (currentRouteObj.arguments) {
                                for (const [key, value] of Object.entries(currentRouteObj.arguments)) {
                                    route = route.replace(`:${key}`, value);
                                }
                                if (currentRouteObj.arguments['?query'] !== undefined) {
                                    let searchParams = new URLSearchParams(currentRouteObj.arguments['?query']);
                                    route += `?${searchParams.toString()}`;
                                }
                            }
                            if (currentRouteObj.data.fromContext) {
                                if (currentRouteObj.data.fromContext === true) {
                                    lm = lm.fromClosestContext();
                                } else {
                                    lm = lm.fromContext(currentRouteObj.data.fromContext);
                                }
                            }
                        } else {
                            if (currentRouteObj.data.fromVirtualTreeRoot) {
                                lm = lm.fromVirtualTreeRoot();
                            }
                        }
                    }
                    if (ux.isModal()) {
                        if (currentRouteObj.data.updateModalDataPath) {
                            lm.updateModalPathInternalNavigation(route, {}, currentRouteObj.data.addHistoryEntry);
                        }
                    } else if (route) {
                        route === 'main' ? route = '' : route;
                        lm.navigate(route);
                    }
                }
            });
        }
    };

});//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidnNpdW9sLXN1cHBvcnQtbGliLmpzIiwic291cmNlcyI6WyIuLi9zcmMvdnNpdW9sLXN1cHBvcnQtbGliLmpzIl0sInNvdXJjZXNDb250ZW50IjpbInNhcC51aS5kZWZpbmUoW1wic2FwL3VpL21vZGVsL2pzb24vSlNPTk1vZGVsXCIsIFwiQGx1aWdpLXByb2plY3QvY2xpZW50L2x1aWdpLWNsaWVudFwiXSwgZnVuY3Rpb24gKEpTT05Nb2RlbCwgTHVpZ2lDbGllbnQpIHtcblxuICAgIEx1aWdpQ2xpZW50LmFkZEluaXRMaXN0ZW5lcigoY3R4KSA9PiB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdjdHggaW5pdCcsIGN0eCk7XG4gICAgICAgIHRoaXMubW9kZWwuc2V0RGF0YShjdHgpO1xuICAgIH0pO1xuXG4gICAgTHVpZ2lDbGllbnQuYWRkQ29udGV4dFVwZGF0ZUxpc3RlbmVyKChjdHgpID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coJ2N0eCB1cGRhdGUnLCBjdHgpO1xuICAgICAgICB0aGlzLm1vZGVsLnNldERhdGEoY3R4KTtcbiAgICB9KTtcblxuICAgIHJldHVybiB7XG5cbiAgICAgICAgY29ubmVjdFRvOiBmdW5jdGlvbiAob0NvbXBvbmVudCkge1xuICAgICAgICAgICAgY29uc3Qgcm91dGluZ0NvbmZpZyA9IG9Db21wb25lbnQuZ2V0TWFuaWZlc3RFbnRyeSgnc2FwLnVpNScpLnJvdXRpbmc7XG4gICAgICAgICAgICBvQ29tcG9uZW50LmdldFJvdXRlcigpLmF0dGFjaFJvdXRlTWF0Y2hlZCgob0V2ZW50KSA9PiB7XG4gICAgICAgICAgICAgICAgb0NvbXBvbmVudC5zZXRNb2RlbChuZXcgSlNPTk1vZGVsKEx1aWdpQ2xpZW50LmdldENvbnRleHQoKSksIFwiJGx1aWdpXCIpO1xuICAgICAgICAgICAgICAgIGNvbnN0IGN1cnJlbnRSb3V0ZSA9IG9FdmVudC5nZXRQYXJhbWV0ZXIoJ25hbWUnKTtcbiAgICAgICAgICAgICAgICBjb25zdCBhcmdzID0gb0V2ZW50LmdldFBhcmFtZXRlcignYXJndW1lbnRzJyk7XG4gICAgICAgICAgICAgICAgbGV0IGN1cnJlbnRSb3V0ZU9iaiA9IHt9O1xuICAgICAgICAgICAgICAgIHJvdXRpbmdDb25maWcucm91dGVzLmV2ZXJ5KHJvdXRlT2JqID0+IHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJvdXRlT2JqLm5hbWUgPT09IGN1cnJlbnRSb3V0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudFJvdXRlT2JqID0gcm91dGVPYmo7XG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Um91dGVPYmouYXJndW1lbnRzID0gYXJncztcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9KTtcblxuICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um91dGVPYmopIHtcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxtID0gTHVpZ2lDbGllbnQubGlua01hbmFnZXIoKS53aXRob3V0U3luYygpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB1eCA9IEx1aWdpQ2xpZW50LnV4TWFuYWdlcigpO1xuICAgICAgICAgICAgICAgICAgICBsZXQgcm91dGUgPSBjdXJyZW50Um91dGU7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um91dGVPYmouZGF0YSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3V0ZU9iai5kYXRhLmx1aWdpUm91dGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZSA9IGN1cnJlbnRSb3V0ZU9iai5kYXRhLmx1aWdpUm91dGU7XG5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJvdXRlT2JqLmFyZ3VtZW50cykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb3IgKGNvbnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhjdXJyZW50Um91dGVPYmouYXJndW1lbnRzKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcm91dGUgPSByb3V0ZS5yZXBsYWNlKGA6JHtrZXl9YCwgdmFsdWUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um91dGVPYmouYXJndW1lbnRzWyc/cXVlcnknXSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgc2VhcmNoUGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyhjdXJyZW50Um91dGVPYmouYXJndW1lbnRzWyc/cXVlcnknXSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByb3V0ZSArPSBgPyR7c2VhcmNoUGFyYW1zLnRvU3RyaW5nKCl9YDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJvdXRlT2JqLmRhdGEuZnJvbUNvbnRleHQpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGN1cnJlbnRSb3V0ZU9iai5kYXRhLmZyb21Db250ZXh0ID09PSB0cnVlKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsbSA9IGxtLmZyb21DbG9zZXN0Q29udGV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgbG0gPSBsbS5mcm9tQ29udGV4dChjdXJyZW50Um91dGVPYmouZGF0YS5mcm9tQ29udGV4dCk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Um91dGVPYmouZGF0YS5mcm9tVmlydHVhbFRyZWVSb290KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxtID0gbG0uZnJvbVZpcnR1YWxUcmVlUm9vdCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBpZiAodXguaXNNb2RhbCgpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY3VycmVudFJvdXRlT2JqLmRhdGEudXBkYXRlTW9kYWxEYXRhUGF0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxtLnVwZGF0ZU1vZGFsUGF0aEludGVybmFsTmF2aWdhdGlvbihyb3V0ZSwge30sIGN1cnJlbnRSb3V0ZU9iai5kYXRhLmFkZEhpc3RvcnlFbnRyeSlcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfSBlbHNlIGlmIChyb3V0ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgcm91dGUgPT09ICdtYWluJyA/IHJvdXRlID0gJycgOiByb3V0ZTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGxtLm5hdmlnYXRlKHJvdXRlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfTtcblxufSk7Il0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLEdBQUcsQ0FBQyxFQUFFLENBQUMsTUFBTSxDQUFDLENBQUMsNkJBQTZCLEVBQUUsb0NBQW9D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
